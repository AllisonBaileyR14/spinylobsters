---
title: "Analysis of California Spiny Lobster size and abundance based on data from the Santa Barbara Coastal Long-Term Ecological Research Program (2012-2018)"
subtitle: "A mini-report prepared for the ESM 206 Teaching Staff"
author: "Allison Bailey and Becca Reynolds"
date: "11/10/2019"
output: html_document
editor_options: 
chunk_output_type: console
---

```{r setup, include=FALSE}
```

```{r include=FALSE}
# Attach required packages
library(tidyverse)
library(janitor)
library(here)
library(hrbrthemes)
library(viridis)
library(ggthemes)
library(paletteer)
library(DT)
library(plotly)
library(expss)
library(kableExtra)
```
#### **Introduction**
The California Spiny Lobster (*Panulirus interruptus*) is a keystone species within nearshore kelp forest ecosystems along the Southern California coast, and a target of both commercial and recreational fisheries. [1] Due to its value as a natural resource, the California Spiny Lobster has received state protection for over a century. [1] On January 1, 2012, California Fish and Game established two Marine Protection Areas (MPA), Naples and Isla Vista, as part of a greater Network of Marine Protected Areas. [2] In spring 2012, the California Department of Fish and Wildlife began developing a Fishery Management Plan (FMP) under the Marine Life Management Act, resulting in the publication of the California Spiny Lobster FMP in spring 2016. [1] The Santa Barbara Coastal Long-Term Ecological Research (SBC LTER) program was established in 2000 to examine the effect of fishing on kelp forest ecosystem dynamics. The SBC LTER program uses interdisciplinary approaches to study the ecology and dynamics of coastal kelp forest communities in nearshore waters along the coast of southern California. [2] From 2012 to 2018, the SBC LTER program collected data on California Spiny Lobster abundance and size within populations in the nearshore waters of the Santa Barbara Channel. [2] Data collection locations included two MPA sites (Naples and Isla Vista) and three non-MPA sites (Arroyo Quemado, Mohawk and Carpinteria). [2] Each year in August and September, prior to fishing season, abundance and size data were collected by divers. [2] Sampling continues to take place annually. [2] The following report will compare California Spiny Lobster size and abundance data from 2012 to 2018 across SBC LTER study sites, representing MPA sites in dark grey and non-MPA sites in teal.


![](lob_map.png)

**Figure 1.** California Spiny Lobster (left) and spatial coverage of SBC LTER data collection sites (right).
Credit: [Joel Sartore](https://www.joelsartore.com/inv002-00050/) and [SBC LTER EDI Data Portal Site](https://portal.edirepository.org/nis/mapbrowse?scope=knb-lter-sbc&identifier=77&revision=newest)

```{r include=FALSE}
# Read in csv titled "lobster_abundance_sbc_lter.csv"

lobster_data <- read_csv("lobster_abundance_sbc_lter.csv", na = "-99999")
```

```{r include=FALSE}
# Clean data variable titles using janitor clean_names()

lobster_clean <- lobster_data %>%
  clean_names()

# Mutate a new column to reflect the full mdy in proper formate as well as isolating days using lubridate.
lobster_date <- lobster_clean %>% 
  mutate(date_new = lubridate::ymd(date)) %>%
  mutate(day_new = lubridate::day(date)) %>%
  select(-date) %>%
   mutate(site_2 = site)



```


```{r, fig.cap=TRUE, echo=FALSE}
# Results A: Visually explore changes in annual lobster abundance (counts) by site. After grouping observations to find lobster counts for each year, create a finalized data visualization (no modeling/stats needed) showing changes in annual lobster abundance at the five sites over time. You should decide how to best present the data. Make your data visualization correct, clear, responsible, and professional. Details matter (e.g. is it easier to read a legend or label lines directly? How can I designate between MPA and non-MPA sites? And many more decisions!). Add a figure caption below the graph.

lob_abundance <- lobster_date %>%
    select(year, site, count) %>%
  group_by(year, site) %>%
  summarise(
    total_count = sum(count))

lob_site2 <- lobster_date %>%
  select(-site) %>%
  group_by(year, site_2) %>%
  summarise(
    total_count = sum(count)
  )

lob_abund_plot <- ggplot(lob_abundance, aes(x=year, y=total_count)) +
    geom_line(data = lob_site2, aes(group=site_2), color="grey", size=0.5, alpha=0.7) +
    geom_line(aes(color=site), size=1.2 ) +
    theme_ipsum() +
    theme(
      legend.position="none",
      plot.title = element_text(size=14)
    ) +
    ggtitle("Total Lobsters Counted at Sites in Santa Barbara Channel") +
    facet_wrap(~site) +
  scale_color_manual(values=c("#69b3a2", "#69b3a2", "darkslategrey", "#69b3a2", "darkslategrey")) +
  labs(x = "Year",
       y = "Lobster Count")
  

lob_abund_plot +  theme(
    plot.title=element_text( hjust=0.5, vjust=0.5, face='bold'))


```
Caption: 
**Figure 2.** Graphs visualize fluctuations in lobster abundance from 2012-2018 across SBC LTER study sites within the Santa Barbara Channel. MPA study sites include Naples (NAPL) and Isla Vista (IVEE). Non-MPA sites include Arroyo Quemado (AQUE), Mohawk (MOHK), and Carpinteria (CARP).

**Changes in annual California Spiny Lobster abundance for all Santa Barbara Coastline sites**

As of December 2009, the IUCN Red List of Threatened Species has deemed the California Spiny Lobster a species of Least Concern, with a stable population trend. [3] The California Spiny Lobster abundance data collected by the SBC LTER program examines a small percentage of the total California Spiny Lobster population across the specie's geographic range. However, general trends in this data provide evidence of stable, and in some cases increasing, populations within the nearshore kelp forests of the Santa Barbara Channel. Despite the fact that declines in abundance are observed in Carpenteria from 2017-2018, and Naples and Isla Vista from 2015-2016, all study sites have experienced some level of overall increase in California Spiny Lobster abundance from 2012 to 2018, with Isla Vista, an MPA site, displaying the greatest increase in California Spiny Lobster abundance from 2012-2018.   

```{r echo=FALSE}
# Results B. Visually explore lobster size distribution shifts by comparing lobster sizes in 2012 and 2018. Visually explore the size distributions for lobsters observed at the 5 different sites in 2012, and in 2018 (i.e. you will have a total of 10 size distributions shown: for each of the 5 sites, one for 2012 and one for 2018). Make a finalized graph that clearly and professionally shows community size distributions at each site in the 2 years, allowing the reader to easily interpret distribution shifts. Add a figure caption below the graph. 

lobster_tidy <- lobster_date %>%
  tidyr::uncount(count) %>%
  filter(year == "2012" | year == "2018") %>%
  group_by(year, site, size_mm)

lobster_tidy2 <- lobster_date %>%
  tidyr::uncount(count) %>%
  filter(year == "2012" | year == "2018") %>%
  select(-site) %>%
  group_by(year, site_2, size_mm)

lob_dense <- ggplot(lobster_tidy, aes(x = size_mm)) +
  geom_density(data = lobster_tidy2, aes(group = site_2), color = "grey", fill = "grey", alpha = 0.5) +
  geom_density(aes(fill = site, color = site), alpha=.4) +
  scale_color_viridis(discrete = TRUE) +
  theme_ipsum() +
  facet_grid(site ~ year) +
  labs(x = "Size (mm)",
       y = "Density") +
   ggtitle("Lobster Size by Site: 2012 and 2018 Comparison") +
  scale_color_manual(values=c("#69b3a2", "#69b3a2", "darkslategrey", "#69b3a2", "darkslategrey")) +
  scale_fill_manual(values=c("#69b3a2", "#69b3a2", "darkslategrey", "#69b3a2", "darkslategrey")) +
  theme(
      legend.position="none",
      plot.title = element_text(size=14)
    ) 

lob_dense +
   theme(
    plot.title=element_text(hjust=0.5, vjust=0.5, face='bold'))

```
Caption:
**Figure 3.** Graphs visualize California Spiny Lobster size distribution shifts from the start (2012) and the end (2018) of the data collection period examined in this mini-report. These shifts are examined for all SBC LTER study sites.

**Shifts in community size structure for all Santa Barbara Coastline sites in years 2012 and 2018** 




In text, describe general / interesting trends that you see in community size structure at different sites (again, considering MPA vs. non-MPA status) for lobsters between 2012 and 2018. 




```{r echo=FALSE}
# Results C. Compare mean lobster sizes at MPA vs. non-MPA sites in 2012 and 2018. Here, for each year (2012 and 2018) consolidate the size observations into only two groups: MPA and non-MPA lobsters. 

lobster_name <- lobster_tidy %>% 
  mutate(mpa_affil = case_when(site %in% c("CARP", "MOHK", "AQUE") ~ "non-MPA",
                               TRUE ~ "MPA")) %>%
  group_by(mpa_affil, year, size_mm)
  

lobster_box <- ggplot(lobster_name, aes(x = mpa_affil, y = size_mm, group = mpa_affil, fill = mpa_affil))

lob_boxplot <- lobster_box +
  geom_boxplot(alpha = .7) +
    guides(fill = "none") +
    theme_ipsum() +
  facet_wrap(~year) +
   scale_color_paletteer_d(awtools, a_palette) +
  scale_fill_paletteer_d(awtools, a_palette) +
    labs(x = "MPA Affiliation",
       y = "Mean Size (mm)")
  
lob_boxplot +
   theme(
    plot.title=element_text( hjust=0.5, vjust=0.5, face='bold'))
```

```{r echo=FALSE}
lobster_summary <- lobster_name %>%
  select(mpa_affil, size_mm, year) %>%
  group_by(mpa_affil, year) %>%
  summarize(
    mean_size = mean(size_mm, na.rm = TRUE),
    sd_size = sd(size_mm, na.rm = TRUE),
    sample_n = n()
  )

datatable(lobster_summary)

```

```{r include=FALSE}
# Sample size (MPA vs non-MPA):
mpa_filter <- lobster_name %>%
  filter(mpa_affil == "MPA")

nonmpa_filter <- lobster_name %>%
  filter(mpa_affil == "non-MPA")

n_mpa <- sum(!is.na(mpa_filter$size_mm))
n_nonmpa <- sum(!is.na(nonmpa_filter$size_mm))

# Means (MPA v. nonMPA):
mean_mpa <- mean(mpa_filter$size_mm, na.rm = TRUE)
mean_nonmpa <- mean(nonmpa_filter$size_mm, na.rm = TRUE)

# Medians (MPA v. non MPA):
median_mpa <- median(mpa_filter$size_mm, na.rm = TRUE)
median_nonmpa <- median(nonmpa_filter$size_mm, na.rm = TRUE)

# Standard deviations (immediate v. 2 min flushing):
sd_mpa <- sd(mpa_filter$size_mm, na.rm = TRUE)
sd_nonmpa <- sd(nonmpa_filter$size_mm, na.rm = TRUE)
```

```{r include=FALSE}
mpa_sample <- lobster_name %>%
  filter(mpa_affil == "MPA") %>%
  pull(size_mm)

t.test(mpa_sample)

nonmpa_sample <- lobster_name %>%
  filter(mpa_affil == "non-MPA") %>%
  pull(size_mm)

t.test(nonmpa_sample)

mpa_nonmpa_ttest <- t.test(mpa_sample, nonmpa_sample)

mpa_nonmpa_ttest


```
"Mean lobster sizes (mm) measured at the protected site (MPAs) samples (`r round(mean_mpa, 2)` $\pm$ `r round(sd_mpa, 2)`, n = `r n_mpa`) differed significantly from non protected sites (non-MPAs). (`r round(mean_nonmpa, 2)` $\pm$ `r round(sd_nonmpa, 2)`, n = `r n_nonmpa`) by a paired two-sample t-test (t(`r round(mpa_nonmpa_ttest$parameter, 2)`) = `r round(mpa_nonmpa_ttest$statistic, 2)`, *p* < 7.708e-11)."
```{r echo=FALSE}
lobster_density <- lobster_name

lob_affil <- ggplot(lobster_density, aes(x=size_mm, group = mpa_affil)) +
    geom_density(aes(color = mpa_affil, fill = mpa_affil), alpha=0.8) +
    ggtitle("Size of Lobsters at MPA Sites vs. Non-MPA Sites") +
    theme_ipsum() +
  facet_wrap(~ year) +
  scale_color_paletteer_d(awtools, a_palette) +
  scale_fill_paletteer_d(awtools, a_palette)

lob_affil +
   theme(
    plot.title=element_text( hjust=0.5, vjust=0.5, face='bold'))

```





```{r echo=FALSE}
lobster_ysite <- lobster_date %>%
  count(year, site)

lobster_ysite

lob_heat <- ggplot(data = lobster_ysite, aes(x = year, y = site)) +
  geom_tile(aes(fill = n)) +
  scale_fill_viridis(discrete=FALSE, option="cividis")

lob_heat
        
```

**References**
[1] “California Spiny Lobster Fishery Management Plan.” [Online]. Available: https://www.wildlife.ca.gov/Conservation/Marine/Lobster-FMP. [Accessed: 16-Nov-2019].

[2] “Santa Barbara Coastal LTER.” [Online]. Available: https://sbclter.msi.ucsb.edu/. [Accessed: 16-Nov-2019].

[3] “The IUCN Red List of Threatened Species,” IUCN Red List of Threatened Species. [Online]. Available: https://www.iucnredlist.org/en. [Accessed: 16-Nov-2019].
